function rcube_mail_ui(){var z={};var g={};var C={forwardmenu:{editable:1},searchmenu:{editable:1,callback:a},listoptions:{editable:1},dragmessagemenu:{sticky:1},groupmenu:{above:1},mailboxmenu:{above:1},spellmenu:{callback:e},"attachment-form":{editable:1,above:1,toggle:!bw.ie&&!bw.linux},"upload-form":{editable:1,toggle:!bw.ie&&!bw.linux}};var H=this;var j;var J={};this.set=r;this.init=w;this.init_tabs=B;this.show_about=s;this.show_popup=l;this.set_searchmod=h;this.show_uploadform=n;this.show_header_row=c;this.hide_header_row=I;if(window.$&&document.body){var v=rcmail.get_cookie("minimalmode");if(parseInt(v)||(v===null&&$(window).height()<850)){$(document.body).addClass("minimal")}if(bw.tablet){$("#viewport").attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}}function r(K,L){z[K]=L}function w(){rcmail.addEventListener("message",D);$("#taskbar a").each(function(R,S){$(S).append('<span class="tooltip">'+$(".button-inner",this).html()+"</span>")});$("#taskbar .minmodetoggle").click(function(S){var R=$(document.body).toggleClass("minimal").hasClass("minimal");rcmail.set_cookie("minimalmode",R?1:0);$(window).resize()});if(rcmail.env.task=="mail"){rcmail.addEventListener("menu-open",d);rcmail.addEventListener("menu-save",q);rcmail.addEventListener("responseafterlist",function(R){x(rcmail.env.threading?"thread":"list")});var N=$("#dragmessagemenu");if(N.length){rcmail.gui_object("message_dragmenu","dragmessagemenu");g.dragmessagemenu=N}if(rcmail.env.action=="show"||rcmail.env.action=="preview"){rcmail.addEventListener("aftershow-headers",function(){t()});rcmail.addEventListener("afterhide-headers",function(){t()});$("#previewheaderstoggle").click(function(R){A(this);return false})}else{if(rcmail.env.action=="compose"){rcmail.addEventListener("aftertoggle-editor",function(){window.setTimeout(function(){u()},200)});rcmail.addEventListener("aftersend-attachment",n);rcmail.addEventListener("add-recipient",function(R){c(R.field,true)});u();var Q,K=["cc","bcc","replyto","followupto"];for(var P=0;P<K.length;P++){if((Q=$("#_"+K[P]))&&Q.length&&Q.val()!=""){c(K[P],true)}}$("#composeoptionstoggle").click(function(){$("#composeoptionstoggle").toggleClass("remove");$("#composeoptions").toggle();u();return false}).css("cursor","pointer");var O=rcmail.opener();if(O&&O.env.action=="compose"&&$("#composeoptionstoggle",opener.document).hasClass("remove")){$("#composeoptionstoggle").click()}new rcube_splitter({id:"composesplitterv",p1:"#composeview-left",p2:"#composeview-right",orientation:"v",relative:true,start:248,min:170,size:12,render:u}).init()}else{if(rcmail.env.action=="list"||!rcmail.env.action){var M=$("#mailpreviewframe").is(":visible");$("#mailpreviewtoggle").addClass(M?"enabled":"closed").click(function(R){o(R);return false});$("#maillistmode").addClass(rcmail.env.threading?"":"selected").click(function(R){x("list");return false});$("#mailthreadmode").addClass(rcmail.env.threading?"selected":"").click(function(R){x("thread");return false});j=new rcube_splitter({id:"mailviewsplitter",p1:"#mailview-top",p2:"#mailview-bottom",orientation:"h",relative:true,start:310,min:150,size:12,offset:4});if(M){j.init()}new rcube_scroller("#folderlist-content","#folderlist-header","#folderlist-footer");rcmail.addEventListener("setquota",b)}}}if($("#mailview-left").length){new rcube_splitter({id:"mailviewsplitterv",p1:"#mailview-left",p2:"#mailview-right",orientation:"v",relative:true,start:226,min:150,size:12,callback:f,render:y}).init()}}else{if(rcmail.env.task=="settings"){rcmail.addEventListener("init",function(){var R="#settingstabpreferences";if(rcmail.env.action){R="#settingstab"+(rcmail.env.action.indexOf("identity")>0?"identities":rcmail.env.action.replace(/\./g,""))}$(R).addClass("selected").children().first().removeAttr("onclick").click(function(){return false})});if(rcmail.env.action=="folders"){new rcube_splitter({id:"folderviewsplitter",p1:"#folderslist",p2:"#folder-details",orientation:"v",relative:true,start:266,min:180,size:12}).init();new rcube_scroller("#folderslist-content","#folderslist-header","#folderslist-footer");rcmail.addEventListener("setquota",b)}else{if(rcmail.env.action=="identities"){new rcube_splitter({id:"identviewsplitter",p1:"#identitieslist",p2:"#identity-details",orientation:"v",relative:true,start:266,min:180,size:12}).init()}else{if(rcmail.env.action=="preferences"||!rcmail.env.action){new rcube_splitter({id:"prefviewsplitter",p1:"#sectionslist",p2:"#preferences-box",orientation:"v",relative:true,start:266,min:180,size:12}).init()}}}}else{if(rcmail.env.task=="addressbook"){rcmail.addEventListener("afterupload-photo",n);if(rcmail.env.action==""){new rcube_splitter({id:"addressviewsplitterd",p1:"#addressview-left",p2:"#addressview-right",orientation:"v",relative:true,start:226,min:150,size:12,render:y}).init();new rcube_splitter({id:"addressviewsplitter",p1:"#addresslist",p2:"#contacts-box",orientation:"v",relative:true,start:286,min:270,size:12}).init();new rcube_scroller("#directorylist-content","#directorylist-header","#directorylist-footer")}}}}var L=$(".minwidth");if(L.length){L.css("min-width",$(".toolbar").width()+$("#quicksearchbar").parent().width()+20)}$(".tabbed").each(function(R,S){B(S)});$("select.decorated").each(function(){if(bw.opera){$(this).removeClass("decorated");return}var S=$(this),R=Math.max(S.height(),26)-2,V=S.width()-22,W=$("option",this).first().text();if($("option:selected",this).val()!=""){W=$("option:selected",this).text()}var T=$('<a class="menuselector"><span class="handle">'+W+"</span></a>").css("position","absolute").offset(S.position()).insertAfter(S);T.children().width(V).height(R).css("line-height",(R-1)+"px");S.change(function(){var X=$("option:selected",this).text();$(this).next().children().html(X)});var U=S.parent();if(U.css("position")!="absolute"){U.css("position","relative")}S.width(T.width())});$(document.body).bind("mouseup",F).bind("keyup",function(R){if(R.keyCode==27){for(var S in g){if(g[S].is(":visible")){l(S,false)}}}});$("iframe").load(function(S){try{var R=this.contentDocument?this.contentDocument:this.contentWindow?this.contentWindow.document:null;$(R).mouseup(F)}catch(S){}}).contents().mouseup(F);window.onresize=E;E()}function F(O){var L,N,M=O.target;if(M.className=="inner"){M=O.target.parentNode}for(var P in g){N=g[P];L=C[P];if(N.is(":visible")&&M.id!=P+"link"&&!L.toggle&&(!L.editable||!k(M,N.get(0)))&&(!L.sticky||!rcube_mouse_is_over(O,N.get(0)))){var K=P+"";window.setTimeout(function(){m(K,false)},10)}}}function E(){if(rcmail.env.task=="mail"){if(rcmail.env.action=="show"||rcmail.env.action=="preview"){t()}else{if(rcmail.env.action=="compose"){u()}}}$("body.iframe .footerleft").each(function(){var O=$(this),K=$(document.body),N=O.hasClass("floating"),M=K.outerHeight(true)>$(window).height();if(M!=N){var L=M?"addClass":"removeClass";O[L]("floating");K[L]("floatingbuttons")}})}function D(K){if(K.type=="error"&&rcmail.env.task!="login"){if(H.message_timer){window.clearTimeout(H.message_timer)}if(!H.messagedialog){H.messagedialog=$("<div>").addClass("popupdialog").hide()}var L=K.message,M=$(K.object).offset();M.top-=(rcmail.env.task=="login"?20:160);if(H.messagedialog.is(":visible")){L=H.messagedialog.html()+"<p>"+K.message+"</p>"}H.messagedialog.html(L).dialog({resizable:false,closeOnEscape:true,dialogClass:"popupmessage "+K.type,title:z.errortitle,close:function(){H.messagedialog.dialog("destroy").hide()},position:["center",M.top],hide:{effect:"drop",direction:"down"},width:420,minHeight:90}).show();H.message_timer=window.setTimeout(function(){H.messagedialog.dialog("close")},Math.max(2000,K.timeout/2))}}function t(){$("#messagecontent").css("top",($("#messageheader").outerHeight()+1)+"px");$("#message-objects div a").addClass("button");if(!$("#attachment-list li").length){$("div.rightcol").hide();$("div.leftcol").css("margin-right","0")}}function f(K){}function y(K){}function u(){var Q=$("#composebody"),L=$("#compose-content"),K=$("#composeview-bottom"),R,P,O,T,N=0,S=300,O=(L.height()-K.position().top);T=S-O;N=T>-100?0:40;K.css("height",Math.max(S,O)+"px");L.css("overflow",T>0?"auto":"hidden");R=Q.parent().width()-5;P=Q.parent().height()-16;Q.width(R).height(P);$("#composebody_tbl").width((R+8)+"px").height("").css("margin-top","1px");$("#composebody_ifr").width((R+8)+"px").height((P-40)+"px");$("#googie_edit_layer").height(P+"px");var M=$("#directorylist");$("#compose-contacts .scroller").css("top",M.position().top+M.outerHeight())}function b(M){var K=24,L=20,N=M.total?Math.ceil(M.percent/100*L)*K:0;if(M.total&&N==K*L&&M.percent<100){N-=K}$("#quotadisplay").css("background-position","0 -"+N+"px")}function l(L,K,M){if(M||!C[L]){C[L]=$.extend(C[L]||{},M)}var N=m(L,K),M=C[L];if(typeof M.callback=="function"){M.callback(N)}}function m(K,S){var N=g[K],M=C[K],L=$("#"+K+"link"),P=M.above;if(!N){N=g[K]=$("#"+K);N.appendTo(document.body)}if(!N||!N.length){return false}if(typeof S=="undefined"){S=N.is(":visible")?false:true}else{if(M.toggle&&S&&N.is(":visible")){S=false}}if(S&&L){var R=L.parent(),O=$(window),Q;if(R.hasClass("dropbutton")){L=R}Q=L.offset();L.offsetHeight=L.outerHeight();if(!P&&Q.top+L.offsetHeight+N.height()>O.height()){P=true}if(Q.left+N.width()>O.width()){Q.left=O.width()-N.width()-12}N.css({left:Q.left,top:(Q.top+(P?-N.height():L.offsetHeight))})}N[S?"show":"hide"]();if(bw.ie6&&M.overlap){$("select").css("visibility",S?"hidden":"inherit");$("select",N).css("visibility","inherit")}return S}function k(L,K){while(L.parentNode){if(L.parentNode==K){return true}L=L.parentNode}return false}function o(P){var M=$(P.target),R=$("#mailpreviewframe"),Q=!R.is(":visible"),O=j.pos||parseInt(rcmail.get_cookie("mailviewsplitter")||320),L,N,K;R.toggle();M.removeClass().addClass(Q?"enabled":"closed");if(Q){$("#mailview-top").removeClass("fullheight").css({bottom:"auto"});$("#mailview-bottom").css({height:"auto"});rcmail.env.contentframe="messagecontframe";if(K=rcmail.message_list.get_single_selection()){rcmail.show_message(K,false,true)}if(j.handle){j.handle.show();j.resize()}else{j.init()}}else{rcmail.env.contentframe=null;rcmail.show_contentframe(false);$("#mailview-top").addClass("fullheight").css({height:"auto",bottom:"28px"});$("#mailview-bottom").css({top:"auto",height:"26px"});if(j.handle){j.handle.hide()}}if(Q&&K&&rcmail.message_list){rcmail.message_list.scrollto(K)}rcmail.command("save-pref",{name:"preview_pane",value:(Q?1:0)})}function A(L){$("#preview-shortheaders").toggle();var K=$("#preview-allheaders").toggle(),L=$("a#previewheaderstoggle");if(K.is(":visible")){L.attr("href","#hide").removeClass("add").addClass("remove")}else{L.attr("href","#details").removeClass("remove").addClass("add")}}function x(K){if(rcmail.env.threading!=(K=="thread")){rcmail.set_list_options(null,undefined,undefined,K=="thread"?1:0)}$("#maillistmode, #mailthreadmode").removeClass("selected");$("#mail"+K+"mode").addClass("selected")}function a(K){if(K&&rcmail.env.search_mods){var Q,L,O=g.searchmenu,N=$('input:checkbox[name="s_mods[]"]',O),P=rcmail.env.mailbox,M=rcmail.env.search_mods;if(rcmail.env.task=="mail"){M=M[P]?M[P]:M["*"];L="text"}else{L="*"}if(M[L]){N.map(function(){this.checked=true;this.disabled=this.value!=L})}else{N.prop("disabled",false).prop("checked",false);for(Q in M){$("#s_mod_"+Q).prop("checked",true)}}}}function e(L){var N,K,P=rcmail.spellcheck_lang(),O=g.spellmenu,M=$("ul",O);if(!M.length){M=$('<ul class="toolbarmenu selectable">');for(i in rcmail.env.spell_langs){K=$("<li>");N=$('<a href="#"></a>').text(rcmail.env.spell_langs[i]).addClass("active").data("lang",i).click(function(){rcmail.spellcheck_lang_set($(this).data("lang"))});N.appendTo(K);K.appendTo(M)}M.appendTo(O)}$("li",M).each(function(){var Q=$("a",this);if(Q.data("lang")==P){Q.addClass("selected")}else{if(Q.hasClass("selected")){Q.removeClass("selected")}}})}function d(){var K=$("#listoptions");if(K.is(":visible")){K.dialog("close");return}$('input[name="sort_col"][value="'+rcmail.env.sort_col+'"]').prop("checked",true);$('input[name="sort_ord"][value="DESC"]').prop("checked",rcmail.env.sort_order=="DESC");$('input[name="sort_ord"][value="ASC"]').prop("checked",rcmail.env.sort_order!="DESC");$('input[name="list_col[]"]').each(function(){$(this).prop("checked",$.inArray(this.value,rcmail.env.coltypes)!=-1)});K.dialog({modal:true,resizable:false,closeOnEscape:true,title:null,close:function(){K.dialog("destroy").hide()},width:650}).show()}function q(){$("#listoptions").dialog("close");var L=$('input[name="sort_col"]:checked').val(),K=$('input[name="sort_ord"]:checked').val(),M=$('input[name="list_col[]"]:checked').map(function(){return this.value}).get();rcmail.set_list_options(M,L,K,rcmail.env.threading)}function h(O){var M,K,L=rcmail.env.task,N=rcmail.env.search_mods,P=rcmail.env.mailbox;if(!N){N={}}if(L=="mail"){if(!N[P]){N[P]=rcube_clone_object(N["*"])}K=N[P];M="text"}else{K=N;M="*"}if(!O.checked){delete (K[O.value])}else{K[O.value]=1}if(O.value!=M){return}$('input:checkbox[name="s_mods[]"]').map(function(){if(this==O){return}this.checked=true;if(O.checked){this.disabled=true;delete K[this.value]}else{this.disabled=false;K[this.value]=1}})}function n(){var K=$("#upload-dialog");if(K.is(":visible")){K.dialog("close");return}if(rcmail.env.action=="compose"&&!K.data("extended")){$("<a>").addClass("iconlink add").attr("href","#add").html("Add").appendTo($('input[type="file"]',K).parent()).click(G);K.data("extended",true)}K.dialog({modal:true,resizable:false,closeOnEscape:true,title:K.attr("title"),close:function(){try{$("#upload-dialog form").get(0).reset()}catch(L){}K.dialog("destroy").hide();$("div.addline",K).remove()},width:480}).show();if(!document.all){$("input[type=file]",K).first().click()}}function G(K){var M=$(this).parent();var L=M.clone().addClass("addline").insertAfter(M);L.children(".iconlink").click(G);L.children("input").val("");if(!document.all){$("input[type=file]",L).click()}}function c(M,K){var L=$("#compose-"+M);if(L.is(":visible")){return}if(J[M]&&!K){$("#_"+M).val(J[M])}L.show();$("#"+M+"-link").hide();u();return false}function I(L){var K=$("#_"+L);J[L]=K.val();K.val("");$("#compose-"+L).hide();$("#"+L+"-link").show();u();return false}function B(N,O){var M=$(N),P=M.get(0).id,K=M.children("fieldset");if(!K.length){return}if(!P){P="rcmtabcontainer";M.attr("id",P)}O=O||0;K.each(function(Q){if(Q!=O){$(this).hide()}});var L=$("<div>").addClass("tabsbar").prependTo(M);K.each(function(Q){var T,R,U=$(this),S=U.children("legend");R=$("<a>").text(S.text()).attr("href","#");T=$("<span>").attr({id:"tab"+Q,"class":"tablink"}).click(function(){p(P,Q);return false});S.remove();U.addClass("tab");if(Q==O){T.addClass("selected")}T.append(R).appendTo(L)})}function p(M,L){var K=$("#"+M).children("fieldset");K.each(function(N){$(this)[L==N?"show":"hide"]();$("#tab"+N).toggleClass("selected",N==L)});E()}function s(N){var O=$("<iframe>").attr("id","aboutframe").attr("src",rcmail.url("settings/about")).attr("frameborder","0").appendTo(document.body);var L=Math.floor($(window).height()*0.75);var M={};var K=$("#supportlink");if(K.length&&(z.supporturl=K.attr("href"))){M[K.html()]=function(P){z.supporturl.indexOf("mailto:")<0?window.open(z.supporturl):location.href=z.supporturl}}O.dialog({modal:true,resizable:false,closeOnEscape:true,title:N?N.title||N.innerHTML:null,close:function(){O.dialog("destroy").remove()},buttons:M,width:640,height:L}).width(640)}}function rcube_scroller(c,d,a){var b=this;this.list=$(c);this.top=$(d);this.bottom=$(a);this.step_size=6;this.step_time=20;this.delay=500;this.top.mouseenter(function(){if(rcmail.drag_active){b.ts=window.setTimeout(function(){b.scroll("down")},b.delay)}}).mouseout(function(){if(b.ts){window.clearTimeout(b.ts)}});this.bottom.mouseenter(function(){if(rcmail.drag_active){b.ts=window.setTimeout(function(){b.scroll("up")},b.delay)}}).mouseout(function(){if(b.ts){window.clearTimeout(b.ts)}});this.scroll=function(e){var g=this,f=this.step_size;if(!rcmail.drag_active){return}if(e=="down"){f*=-1}this.list.get(0).scrollTop+=f;this.ts=window.setTimeout(function(){g.scroll(e)},this.step_time)}}function rcube_splitter(e){this.p=e;this.id=e.id;this.horizontal=(e.orientation=="horizontal"||e.orientation=="h");this.halfsize=(e.size!==undefined?e.size:10)/2;this.pos=e.start||0;this.min=e.min||20;this.offset=e.offset||0;this.relative=e.relative?true:false;this.drag_active=false;this.render=e.render;this.callback=e.callback;var c=this;rcube_splitter._instances[this.id]=c;this.init=function(){this.p1=$(this.p.p1);this.p2=$(this.p.p2);if(!this.p1.length||!this.p2.length){return}this.p1pos=this.relative?this.p1.position():this.p1.offset();this.p2pos=this.relative?this.p2.position():this.p2.offset();this.handle=$("<div>").attr("id",this.id).attr("unselectable","on").addClass("splitter "+(this.horizontal?"splitter-h":"splitter-v")).appendTo(this.p1.parent()).bind("mousedown",d);if(this.horizontal){var j=this.p1pos.top+this.p1.outerHeight();this.handle.css({left:"0px",top:j+"px"})}else{var h=this.p1pos.left+this.p1.outerWidth();this.handle.css({left:h+"px",top:"0px"})}if(bw.ie){$(window).resize(b)}var g=rcmail.get_cookie(this.id);if(g&&!isNaN(g)){this.pos=parseFloat(g);this.resize()}else{if(this.pos){this.resize();this.set_cookie()}}};this.resize=function(){if(this.horizontal){this.p1.css("height",Math.floor(this.pos-this.p1pos.top-this.halfsize)+"px");this.p2.css("top",Math.ceil(this.pos+this.halfsize+2)+"px");this.handle.css("top",Math.round(this.pos-this.halfsize+this.offset)+"px");if(bw.ie){var h=parseInt(this.p2.parent().outerHeight(),10)-parseInt(this.p2.css("top"),10)-(bw.ie8?2:0);this.p2.css("height",(h>0?h:0)+"px")}}else{this.p1.css("width",Math.floor(this.pos-this.p1pos.left-this.halfsize)+"px");this.p2.css("left",Math.ceil(this.pos+this.halfsize)+"px");this.handle.css("left",Math.round(this.pos-this.halfsize+this.offset+3)+"px");if(bw.ie){var g=parseInt(this.p2.parent().outerWidth(),10)-parseInt(this.p2.css("left"),10);this.p2.css("width",(g>0?g:0)+"px")}}this.p2.resize();this.p1.resize();if(this.drag_active){$("iframe").each(function(j,k){var l=$(this).offset();$("#iframe-splitter-fix-"+j).css({top:l.top+"px",left:l.left+"px",width:k.offsetWidth+"px",height:k.offsetHeight+"px"})})}if(typeof this.render=="function"){this.render(this)}};function d(g){if(bw.konq||bw.chrome||bw.safari){document.body.style.webkitUserSelect="none"}c.p1pos=c.relative?c.p1.position():c.p1.offset();c.p2pos=c.relative?c.p2.position():c.p2.offset();c.drag_active=true;$(document).bind("mousemove."+this.id,a).bind("mouseup."+this.id,f);$("iframe").each(function(h,j){$("<div>").attr("id","iframe-splitter-fix-"+h).addClass("iframe-splitter-fix").css({background:"#fff",width:j.offsetWidth+"px",height:j.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo("body")})}function a(h){if(!c.drag_active){return false}var j=rcube_event.get_mouse_pos(h);if(c.relative){var g=c.p1.parent().offset();j.x-=g.left;j.y-=g.top}if(c.horizontal){if(((j.y-c.halfsize)>c.p1pos.top)&&((j.y+c.halfsize)<(c.p2pos.top+c.p2.outerHeight()))){c.pos=Math.max(c.min,j.y-c.offset);c.resize()}}else{if(((j.x-c.halfsize)>c.p1pos.left)&&((j.x+c.halfsize)<(c.p2pos.left+c.p2.outerWidth()))){c.pos=Math.max(c.min,j.x-c.offset);c.resize()}}c.p1pos=c.relative?c.p1.position():c.p1.offset();c.p2pos=c.relative?c.p2.position():c.p2.offset();return false}function f(g){if(bw.konq||bw.chrome||bw.safari){document.body.style.webkitUserSelect="auto"}$(document).unbind("."+c.id);c.drag_active=false;$("div.iframe-splitter-fix").remove();c.set_cookie();if(typeof c.callback=="function"){c.callback(c)}return bw.safari?true:rcube_event.cancel(g)}function b(j){if(c.horizontal){var h=parseInt(c.p2.parent().outerHeight(),10)-parseInt(c.p2[0].style.top,10)-(bw.ie8?2:0);c.p2.css("height",(h>0?h:0)+"px")}else{var g=parseInt(c.p2.parent().outerWidth(),10)-parseInt(c.p2[0].style.left,10);c.p2.css("width",(g>0?g:0)+"px")}}this.set_cookie=function(){var g=new Date();g.setYear(g.getFullYear()+1);rcmail.set_cookie(this.id,this.pos,g)}}rcube_splitter._instances={};rcube_splitter.get_instance=function(a){return rcube_splitter._instances[a]};